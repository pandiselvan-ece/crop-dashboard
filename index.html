<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Crop Intelligence Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- Styles from your previous template --- */
        * { margin:0; padding:0; box-sizing:border-box; }
        :root { --primary-color:#667eea; --secondary-color:#764ba2; --success-color:#28a745; --warning-color:#ffc107; --danger-color:#dc3545; --dark-color:#343a40; --light-color:#f8f9fa; --border-radius:15px; --shadow:0 10px 30px rgba(0,0,0,0.1); --shadow-hover:0 15px 40px rgba(0,0,0,0.15); }
        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; overflow-x:hidden; }
        .container { max-width:1600px; margin:0 auto; padding:20px; }
        .header { text-align:center; margin-bottom:30px; color:white; position:relative; }
        .header::before { content:''; position:absolute; top:0; left:50%; transform:translateX(-50%); width:100px; height:4px; background:linear-gradient(90deg,transparent,#fff,transparent); border-radius:2px; }
        .header h1 { font-size:3rem; margin-bottom:15px; text-shadow:2px 2px 4px rgba(0,0,0,0.3); background:linear-gradient(45deg,#fff,#f0f0f0); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .header p { font-size:1.2rem; opacity:0.9; font-weight:300; }
        .status-bar { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: var(--border-radius); padding: 15px 25px; margin-bottom:30px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px; }
        .status-item { display:flex; align-items:center; gap:10px; color:white; }
        .status-indicator { width:12px; height:12px; border-radius:50%; background:var(--success-color); animation:pulse 2s infinite; }
        .status-indicator.warning { background: var(--warning-color); }
        .status-indicator.danger { background: var(--danger-color); }
        @keyframes pulse { 0% {opacity:1;} 50% {opacity:0.5;} 100% {opacity:1;} }
        .dashboard-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:25px; margin-bottom:30px; }
        .card { background:white; border-radius:var(--border-radius); padding:25px; box-shadow:var(--shadow); transition:all 0.3s ease; position:relative; overflow:hidden; }
        .card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,var(--primary-color),var(--secondary-color)); }
        .card:hover { transform:translateY(-5px); box-shadow:var(--shadow-hover); }
        .card-header { display:flex; align-items:center; margin-bottom:25px; padding-bottom:15px; border-bottom:2px solid #f0f0f0; }
        .card-header i { font-size:1.8rem; margin-right:15px; color:var(--primary-color); background:linear-gradient(45deg,var(--primary-color),var(--secondary-color)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .card-header h3 { font-size:1.4rem; color:var(--dark-color); font-weight:600; }
        .sensor-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:15px; }
        .sensor-item { text-align:center; padding:20px 15px; background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); border-radius:12px; border:2px solid transparent; transition:all 0.3s ease; position:relative; }
        .sensor-item:hover { border-color:var(--primary-color); transform:translateY(-3px); box-shadow:0 8px 25px rgba(102,126,234,0.2); }
        .sensor-value { font-size:2rem; font-weight:bold; color:var(--primary-color); margin-bottom:8px; text-shadow:0 2px 4px rgba(0,0,0,0.1); }
        .sensor-label { font-size:0.85rem; color:#666; text-transform:uppercase; letter-spacing:0.8px; font-weight:500; }
        .prediction-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:25px; border-radius:var(--border-radius); text-align:center; margin-bottom:25px; }
        .prediction-title { font-size:1.3rem; margin-bottom:15px; opacity:0.9; }
        .prediction-value { font-size:2.5rem; font-weight:bold; margin-bottom:10px; }
        .prediction-description { font-size:1rem; opacity:0.8; }
        .chart-container { background:white; border-radius:var(--border-radius); padding:30px; box-shadow:var(--shadow); margin-bottom:30px; }
        .chart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; flex-wrap:wrap; gap:20px; }
        .chart-controls { display:flex; gap:15px; align-items:center; flex-wrap:wrap; }
        .btn { padding:12px 24px; border:none; border-radius:10px; cursor:pointer; font-weight:600; transition:all 0.3s ease; text-decoration:none; display:inline-flex; align-items:center; gap:8px; font-size:0.9rem; text-transform:uppercase; letter-spacing:0.5px; }
        .btn-primary { background:linear-gradient(135deg,var(--primary-color) 0%,var(--secondary-color) 100%); color:white; box-shadow:0 4px 15px rgba(102,126,234,0.3); }
        .btn-success { background:linear-gradient(135deg,var(--success-color) 0%,#20c997 100%); color:white; box-shadow:0 4px 15px rgba(40,167,69,0.3); }
        .btn-warning { background:linear-gradient(135deg,var(--warning-color) 0%,#fd7e14 100%); color:white; box-shadow:0 4px 15px rgba(255,193,7,0.3); }
        .time-selector { padding:12px 20px; border:2px solid #ddd; border-radius:10px; font-size:0.9rem; background:white; transition:all 0.3s ease; }
        .time-selector:focus { outline:none; border-color:var(--primary-color); box-shadow:0 0 0 3px rgba(102,126,234,0.1); }
        .chart-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(500px,1fr)); gap:25px; margin-top:25px; }
        .chart-item { background:#f8f9fa; border-radius:12px; padding:20px; border:2px solid #e9ecef; }
        .chart { width:100%; height:400px; }
        .mini-chart { width:100%; height:200px; }
        .water-level-indicator { width:100%; height:200px; background:linear-gradient(to bottom,#e3f2fd,#bbdefb); border-radius:12px; position:relative; overflow:hidden; margin-top:20px; }
        .water-level { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(to top,#2196f3,#64b5f6); transition:height 0.5s ease; border-radius:0 0 12px 12px; }
        .water-level-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:white; font-size:1.5rem; font-weight:bold; text-shadow:0 2px 4px rgba(0,0,0,0.3); }
        .notification { position:fixed; top:20px; right:20px; background:white; border-radius:10px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2); z-index:1000; transform:translateX(400px); transition:transform 0.3s ease; }
        .notification.show { transform:translateX(0); }
        .notification.success { border-left:4px solid var(--success-color); }
        .notification.error { border-left:4px solid var(--danger-color); }
        @media(max-width:768px){ .container{padding:15px;} .header h1{font-size:2.2rem;} .dashboard-grid{grid-template-columns:1fr;} .sensor-grid{grid-template-columns:repeat(2,1fr);} .chart-grid{grid-template-columns:1fr;} }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Enterprise Crop Intelligence Dashboard</h1>
        <p>Real-time monitoring and AI-driven insights for optimal irrigation management</p>
    </div>

    <!-- Status bar -->
    <div class="status-bar">
        <div class="status-item"><div class="status-indicator"></div> Sensors Online</div>
        <div class="status-item"><div class="status-indicator warning"></div> Water Level Low</div>
        <div class="status-item"><div class="status-indicator danger"></div> Gas Alert</div>
    </div>

    <!-- Sensor Cards -->
    <div class="dashboard-grid">
        <div class="card">
            <div class="card-header"><i class="fas fa-thermometer-half"></i><h3>Temperature</h3></div>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <div class="sensor-value" id="temperature">0 °C</div>
                    <div class="sensor-label">Temperature</div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-value" id="humidity">0 %</div>
                    <div class="sensor-label">Humidity</div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><i class="fas fa-tint"></i><h3>Soil & Water</h3></div>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <div class="sensor-value" id="soil_moisture">0 %</div>
                    <div class="sensor-label">Soil Moisture</div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-value" id="water_level">0 %</div>
                    <div class="sensor-label">Water Level</div>
                </div>
            </div>
            <div class="water-level-indicator">
                <div class="water-level" id="water-level"></div>
                <div class="water-level-text" id="water-level-text">0%</div>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><i class="fas fa-gas-pump"></i><h3>Air Quality</h3></div>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <div class="sensor-value" id="gas_sensor">0</div>
                    <div class="sensor-label">Gas Level</div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><i class="fas fa-water"></i><h3>Ultrasonic & Turbidity</h3></div>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <div class="sensor-value" id="ultrasonic">0 cm</div>
                    <div class="sensor-label">Ultrasonic</div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-value" id="turbidity">0 NTU</div>
                    <div class="sensor-label">Turbidity</div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Prediction Card -->
    <div class="prediction-card">
        <div class="prediction-title">AI Irrigation Prediction</div>
        <div class="prediction-value" id="water_needed">No</div>
        <div class="prediction-description" id="prediction-desc">No watering required</div>
    </div>

    <!-- Charts -->
    <div class="chart-grid">
        <div class="chart-item"><canvas id="tempChart" class="chart"></canvas></div>
        <div class="chart-item"><canvas id="humidityChart" class="chart"></canvas></div>
        <div class="chart-item"><canvas id="soilChart" class="chart"></canvas></div>
    </div>
</div>

<!-- Firebase & JS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDPA8xRS7hrf7NaCInGDNLcfO_5CSrFvZw",
  authDomain: "new--one.firebaseapp.com",
  databaseURL: "https://new--one-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "new--one",
  storageBucket: "new--one.appspot.com",
  messagingSenderId: "471686393277",
  appId: "1:471686393277:web:d2ee55771c192376cb76d4",
  measurementId: "G-QJF4QQ354Q"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const sensorRef = ref(database, 'sensors'); // <-- your Firebase node

// Chart.js setup
const timeSeries=[], tempSeries=[], humiditySeries=[], soilMoistureSeries=[];
const tempCtx = document.getElementById('tempChart').getContext('2d');
const humidityCtx = document.getElementById('humidityChart').getContext('2d');
const soilCtx = document.getElementById('soilChart').getContext('2d');

const tempChart = new Chart(tempCtx, { type:'line', data:{ labels:timeSeries, datasets:[{ label:'Temperature (°C)', data:tempSeries, borderColor:'#ff6384', backgroundColor:'rgba(255,99,132,0.2)', fill:true }] }, options:{ responsive:true, plugins:{ legend:{ display:true } }, scales:{ y:{ beginAtZero:true } } } });
const humidityChart = new Chart(humidityCtx, { type:'line', data:{ labels:timeSeries, datasets:[{ label:'Humidity (%)', data:humiditySeries, borderColor:'#36a2eb', backgroundColor:'rgba(54,162,235,0.2)', fill:true }] }, options:{ responsive:true, plugins:{ legend:{ display:true } }, scales:{ y:{ beginAtZero:true } } } });
const soilChart = new Chart(soilCtx, { type:'line', data:{ labels:timeSeries, datasets:[{ label:'Soil Moisture (%)', data:soilMoistureSeries, borderColor:'#ffcd56', backgroundColor:'rgba(255,205,86,0.2)', fill:true }] }, options:{ responsive:true, plugins:{ legend:{ display:true } }, scales:{ y:{ beginAtZero:true } } } });

// Firebase listener
onValue(sensorRef, (snapshot)=>{
  const data = snapshot.val();
  if(data){
    document.getElementById('temperature').innerText = data.temperature+' °C';
    document.getElementById('humidity').innerText = data.humidity+' %';
    document.getElementById('soil_moisture').innerText = data.soil_moisture+' %';
    document.getElementById('ultrasonic').innerText = data.ultrasonic+' cm';
    document.getElementById('gas_sensor').innerText = data.gas_sensor;
    document.getElementById('turbidity').innerText = data.turbidity;

    // Water level
    const soil = parseFloat(data.soil_moisture) || 0;
    const level = Math.min(100, Math.max(0, soil));
    document.getElementById('water-level').style.height = level+'%';
    document.getElementById('water-level-text').innerText = level+'%';

    // AI prediction
    document.getElementById('water_needed').innerText = level<40?'Yes':'No';
    document.getElementById('prediction-desc').innerHTML = level<40?'<i class="fas fa-exclamation-triangle"></i> Watering required':'<i class="fas fa-check-circle"></i> No watering needed';

    // Update charts
    const now = new Date().toLocaleTimeString();
    timeSeries.push(now);
    tempSeries.push(data.temperature);
    humiditySeries.push(data.humidity);
    soilMoistureSeries.push(data.soil_moisture);

    if(timeSeries.length>50){ timeSeries.shift(); tempSeries.shift(); humiditySeries.shift(); soilMoistureSeries.shift(); }
    tempChart.update(); humidityChart.update(); soilChart.update();
  }
});
</script>
</body>
</html>
